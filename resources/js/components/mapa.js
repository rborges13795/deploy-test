// Coordenadas da localização especificada
var latitude = -29.152297979915136;
var longitude = -51.2440425; 

let popupPositionY = () => {
    return screen.width > 992 ? 170 : 0;
}

// Criando o mapa com base nas coordenadas especificadas
var map = L.map('mapa', {
    closePopupOnClick: false
}).setView([latitude, longitude], 14);

// Desabilitar o scroll do mouse
map.scrollWheelZoom.disable();

// Criando uma camada de mapa
var layer = new L.TileLayer(
   "http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 16
    }
);
// Adicionando a camada ao mapa
map.addLayer(layer);

let customIcon = {
   iconUrl: $("#map-icon").val(),
   iconSize: [16, 20],
   popupAnchor: [popupPositionY(), 0],
   setZIndex: 10,
}
let myIcon = L.icon(customIcon);

let iconOptions = {
   title: 'Servitec',
   draggable: false,
   icon: myIcon,
}

// Criando o marcador
let marker = new L.Marker([latitude, longitude], iconOptions);
let address = $("#address").val();
marker.addTo(map);

// Bind do popup com opções
marker.bindPopup(`<p>
    <a href="https://maps.app.goo.gl/zwMjqm3PAMHqRvmbA" target="_blank" aria-labe="navegar para mapa">
        <svg xmlns="http://www.w3.org/2000/svg" width="238" height="57" viewBox="0 0 238 57" fill="none">
            <g clip-path="url(#clip0_404_1899)">
                <path d="M58.6303 21.3269C58.1795 27.6326 56.2216 36.1005 51.2498 44.8534C53.1303 36.5537 54.3025 30.1186 53.8774 26.5579C52.2287 12.9107 31.9807 17.3907 19.229 17.4684C13.7291 17.4943 8.31932 17.9216 4.1203 16.9893C3.0641 16.7563 1.13203 16.1736 0.642578 14.5551C1.46693 14.827 2.6004 14.9306 3.25731 14.9824C7.90714 15.3579 14.0769 14.8659 18.1471 14.4515C27.4339 13.5193 38.9619 10.839 45.299 10.2823C47.2053 10.114 52.0999 9.75142 55.4102 12.2892C57.4968 13.8689 58.9523 16.6268 58.6303 21.3269Z" fill="white"/>
                <path d="M44.3974 56.8302C44.6035 25.4572 29.688 25.3407 18.2244 23.5409C12.8919 22.6993 5.91068 21.534 2.94818 20.6017C1.93062 20.278 0.964589 19.5918 0.642578 18.5042C1.46693 18.7761 2.6004 18.9703 3.25731 19.0868C7.28888 19.8378 19.4995 19.6565 25.1669 19.5011C36.3085 19.1774 44.7323 19.1257 48.5578 23.9164C54.7533 31.6593 44.3974 56.8302 44.3974 56.8302Z" fill="white"/>
                <path d="M61.6564 1.17985C59.325 0.71372 56.9808 0.77846 54.6237 1.01152C52.6015 1.1669 49.9867 1.73661 46.8697 2.51349C37.7632 4.77938 25.4109 8.67673 9.07847 10.6578C7.62298 10.839 4.96961 11.0592 3.24363 10.9167C2.58673 10.8649 1.45325 10.7743 0.628906 10.4894C1.19565 12.341 3.60429 12.7553 4.82793 12.8719C14.6557 13.7912 30.8464 10.0233 41.666 8.36597C46.6636 7.60204 50.927 7.22655 53.9024 7.861C53.9925 7.87395 54.0827 7.89985 54.1729 7.9128C57.496 8.70262 62.133 10.114 61.7079 19.4235C61.5405 23.2303 60.6517 26.0788 59.0674 31.1026C60.626 28.7461 67.6072 16.9893 68.1481 9.38886C68.3285 4.79233 66.1517 2.07326 61.6564 1.17985Z" fill="white"/>
                <path d="M75.8516 54.5515L77.7965 44.97H80.9007C82.2145 44.97 83.2836 45.3714 84.1079 46.1741C84.9451 46.9899 85.3573 48.0127 85.3573 49.2687C85.3573 51.923 83.1677 54.5515 80.0892 54.5515H75.8516ZM77.8867 52.9977H80.1407C81.1068 52.9977 81.9311 52.6352 82.6009 51.9101C83.2836 51.185 83.6313 50.3563 83.6313 49.437C83.6313 48.5825 83.3737 47.8833 82.8328 47.3524C82.3175 46.8215 81.6349 46.5367 80.7719 46.5367H79.2005L77.8867 52.9977Z" fill="white"/>
                <path d="M90.7031 54.5515L92.6481 44.97H94.374L92.4291 54.5515H90.7031Z" fill="white"/>
                <path d="M99.3711 54.5515L101.316 44.97H102.772L106.507 51.7418L107.872 44.97H109.521L107.576 54.5515H106.236L102.424 47.6502L101.033 54.5515H99.3711Z" fill="white"/>
                <path d="M113.643 54.5515L119.568 44.97H121.023L123.058 54.5515H121.384L120.984 52.6352H116.747L115.562 54.5515H113.643ZM117.571 51.2238H120.675L119.902 47.443L117.571 51.2238Z" fill="white"/>
                <path d="M129.125 54.5515L131.07 44.97H132.538L134.741 50.3434L139.313 44.97H140.82L138.875 54.5515H137.253L138.566 48.1422L134.29 53.1142L132.126 47.9221L130.787 54.5515H129.125Z" fill="white"/>
                <path d="M146.862 47.6372C147.351 46.7826 148.034 46.0964 148.897 45.5914C149.76 45.0735 150.7 44.8145 151.731 44.8145C153.109 44.8145 154.255 45.2418 155.144 46.0834C156.033 46.9251 156.484 47.9997 156.484 49.2945C156.484 50.2138 156.252 51.0943 155.775 51.9359C155.312 52.7646 154.642 53.4379 153.766 53.9687C152.903 54.4867 151.937 54.7456 150.881 54.7456C149.502 54.7456 148.356 54.3313 147.467 53.5026C146.579 52.661 146.141 51.6122 146.141 50.3304C146.141 49.3852 146.385 48.4788 146.862 47.6372ZM148.678 52.3632C149.271 52.9329 150.031 53.2048 150.984 53.2048C152.04 53.2048 152.941 52.8164 153.676 52.0525C154.423 51.2885 154.796 50.421 154.796 49.437C154.796 48.5435 154.513 47.8055 153.92 47.2358C153.328 46.6531 152.568 46.3683 151.628 46.3683C150.572 46.3683 149.683 46.7567 148.936 47.5336C148.189 48.3105 147.815 49.1909 147.815 50.2009C147.828 51.0813 148.111 51.7935 148.678 52.3632ZM149.76 44.1283L151.975 42.4709H153.238L154.745 44.1283H153.264L152.568 43.196L151.447 44.1283H149.76Z" fill="white"/>
                <path d="M161.803 54.5515L163.748 44.97H165.216L167.419 50.3434L171.978 44.97H173.485L171.54 54.5515H169.917L171.231 48.1422L166.955 53.1142L164.791 47.9221L163.451 54.5515H161.803Z" fill="white"/>
                <path d="M178.443 54.5515L180.388 44.97H186.455L186.146 46.5237H181.779L181.316 48.8155H185.386L185.09 50.3434H181.019L180.491 52.9977H184.948L184.613 54.5515H178.443Z" fill="white"/>
                <path d="M192.921 54.5515L194.544 46.5237H191.955L192.277 44.97H199.129L198.795 46.5237H196.244L194.621 54.5515H192.921Z" fill="white"/>
                <path d="M203.291 54.5515L205.236 44.97H208.585C209.435 44.97 210.131 45.2289 210.659 45.7468C211.2 46.2518 211.483 46.9122 211.483 47.7149C211.483 48.4141 211.264 49.0615 210.839 49.6571C210.414 50.2527 209.873 50.6541 209.19 50.9001L210.684 54.5515H208.855L207.49 51.1332H205.713L205.03 54.5515H203.291ZM205.996 49.6183H207.992C208.482 49.6183 208.894 49.437 209.242 49.1004C209.59 48.7378 209.757 48.3494 209.757 47.8962C209.757 47.1193 209.177 46.5367 208.353 46.5367H206.627L205.996 49.6183Z" fill="white"/>
                <path d="M217.768 47.6371C218.258 46.7825 218.94 46.0963 219.803 45.5913C220.666 45.0734 221.607 44.8145 222.637 44.8145C224.015 44.8145 225.162 45.2417 226.05 46.0834C226.939 46.925 227.39 47.9997 227.39 49.2944C227.39 50.2138 227.158 51.0942 226.681 51.9358C226.218 52.7645 225.548 53.4378 224.672 53.9687C223.809 54.4866 222.843 54.7455 221.787 54.7455C220.409 54.7455 219.262 54.3312 218.374 53.5025C217.485 52.6609 217.047 51.6121 217.047 50.3303C217.047 49.3851 217.292 48.4787 217.768 47.6371ZM219.584 52.3631C220.177 52.9328 220.937 53.2047 221.89 53.2047C222.946 53.2047 223.848 52.8163 224.582 52.0524C225.329 51.2884 225.703 50.4209 225.703 49.4369C225.703 48.5435 225.419 47.8054 224.827 47.2357C224.234 46.6531 223.474 46.3682 222.534 46.3682C221.478 46.3682 220.589 46.7566 219.842 47.5335C219.095 48.3104 218.721 49.1909 218.721 50.2008C218.721 51.0813 219.018 51.7934 219.584 52.3631Z" fill="white"/>
                <path d="M90.7526 16.3937H87.2105L86.0512 20.8219H93.3416L96.1366 24.3826L94.0371 34.5209L89.5934 38.0428H78.5548L75.7598 34.5209L77.1637 28.1505H84.4541L83.9646 30.7142H87.4681L88.666 26.2472H81.1695L78.5806 22.7253L80.7187 12.587L85.1625 9.06519H95.9048L98.9574 12.587L97.2959 18.9574H90.0442L90.7526 16.3937Z" fill="white"/>
                <path d="M116.154 30.753L114.505 38.0428H99.963L97.168 34.5209L102.114 12.587L106.519 9.06519H121.048L119.438 16.3549H108.644L107.691 19.9156H117.648L116.244 26.0011H106.287L105.334 30.766H116.154V30.753Z" fill="white"/>
                <path d="M124.912 38.0428H117.66L124.203 9.06519H138.733L141.528 12.6259L139.918 19.9156L135.435 23.6835L138.282 27.2441L135.783 38.0428H128.66L131.004 27.2441H127.501L124.912 38.0428ZM129.15 19.9156H132.653L133.606 16.3549H129.858L129.15 19.9156Z" fill="white"/>
                <path d="M152.733 9.06519L149.191 24.8747L150.337 27.8915L152.72 24.8747L156.43 9.06519H163.72L159.482 27.1924L149.886 38.0428H146.177L141.488 27.1924L145.481 9.06519H152.733Z" fill="white"/>
                <path d="M167.597 38.0428H160.346L166.889 9.06519H174.179L167.597 38.0428Z" fill="white"/>
                <path d="M195.624 9.06519L193.937 16.3937H188.579L183.684 38.0428H176.433L181.327 16.3937H175.686L177.334 9.06519H195.624Z" fill="white"/>
                <path d="M211.996 30.753L210.348 38.0428H195.819L193.023 34.5209L197.957 12.587L202.362 9.06519H216.891L215.281 16.3549H204.487L203.534 19.9156H214.572L212.924 27.2053H201.885L201.19 30.766H211.996V30.753Z" fill="white"/>
                <path d="M214.404 34.5209L219.299 12.587L223.743 9.06519H234.781L237.628 12.587L235.979 19.9156H228.689L229.384 16.3549H225.881L222.583 30.766H226.087L227.04 27.2053H234.33L232.682 34.5339L228.238 38.0557H217.199L214.404 34.5209Z" fill="white"/>
            </g>
            <defs>
                <clipPath id="clip0_404_1899">
                    <rect width="237" height="56" fill="white" transform="translate(0.5 0.830322)"/>
                </clipPath>
            </defs>
        </svg>
        ${address}
    </a>
</p>`, {
    autoClose: false,
    closeButton: false,
    closeOnClick: false,
    keepInView: true
}).openPopup();

// prevent popup from closing
marker.on('click', function () {
    marker.openPopup();
});

const mapa = document.querySelector('#mapa');